input {
  beats {
    port => 5044
  }
}

filter {
  if "Failed password" in [message] {

    grok {
      match => {
        "message" => [
          "%{SYSLOGTIMESTAMP:timestamp} %{HOSTNAME:host} sshd\\[%{NUMBER}\\]: Failed password for (invalid user )?%{DATA:user.name} from %{IP:source.ip}"
        ]
      }
    }

    date {
      match => ["timestamp", "MMM  d HH:mm:ss", "MMM dd HH:mm:ss"]
      target => "@timestamp"
    }

    mutate {
      add_field => {
        "event.category" => "authentication"
        "event.type" => "start"
        "event.outcome" => "failure"
        "event.kind" => "event"
      }
    }
  }
}

output {
  elasticsearch {
    hosts => ["https://elasticsearch:9200"]
    index => "logs-soc-auth-%{+YYYY.MM.dd}"
    user => "elastic"
    password => "changeme"
    ssl => true
    ssl_verification_mode => "none"
  }
}
